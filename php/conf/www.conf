; 启动一个名为 'www' 的新进程池。
; 变量 $pool 可以在任何指令中使用，它将被替换为进程池名称（此处为 'www'）
[www]

; 每个进程池的前缀
; 仅适用于以下指令：
; - 'access.log'
; - 'slowlog'
; - 'listen'（Unix 套接字）
; - 'chroot'
; - 'chdir'
; - 'php_values'
; - 'php_admin_values'
; 未设置时，将使用全局前缀（或 /opt/php）。
; 注意：此指令也可以相对于全局前缀。
; 默认值：无
;prefix = /path/to/pools/$pool

; 子进程的 Unix 用户/用户组。仅当主进程以 root 用户运行时才能使用此选项。
; 它在子进程创建后设置。
; 用户和用户组可以通过名称或数字 ID 指定。
; 注意：如果用户是 root，则需要使用 --allow-to-run-as-root 选项启动可执行文件。
; 默认值：用户默认设置为主进程运行用户。
;         如果未设置用户组，则使用该用户的用户组。
user = www-data
group = www-data

; 接受 FastCGI 请求的监听地址。
; 有效语法：
;   'ip.add.re.ss:port'    - 在特定 IPv4 地址的特定端口上监听 TCP 套接字；
;   '[ip:6:addr:ess]:port' - 在特定 IPv6 地址的特定端口上监听 TCP 套接字；
;   'port'                 - 在所有地址（IPv6 和 IPv4 映射）的特定端口上监听 TCP 套接字；
;   '/path/to/unix/socket' - 监听 Unix 套接字。
; 注意：此值为必填项。
;listen = 127.0.0.1:9000
listen = 0.0.0.0:36000

; 设置 listen(2) 积压队列长度。
; 默认值：511（在 Linux、FreeBSD 和 OpenBSD 上为 -1）
;listen.backlog = 511

; 设置 Unix 套接字的权限（如果使用）。在 Linux 中，必须设置读/写权限以允许
; 来自 Web 服务器的连接。许多 BSD 衍生系统无论权限如何都允许连接。
; 所有者和用户组可以通过名称或数字 ID 指定。
; 默认值：所有者设置为主进程运行用户。如果未设置用户组，
;         则使用所有者的用户组。模式设置为 0660。
;listen.owner = www-data
;listen.group = www-data
;listen.mode = 0660
listen.owner = www-data
listen.group = www-data
listen.mode = 0660

; 当支持 POSIX 访问控制列表时，可以使用这些选项设置，
; 值为逗号分隔的用户/用户组名称列表。
; 设置后，listen.owner 和 listen.group 将被忽略。
;listen.acl_users =
;listen.acl_groups =

; 允许连接的 FastCGI 客户端地址列表（IPv4/IPv6）。
; 等同于原始 PHP FCGI (5.2.2+) 中的 FCGI_WEB_SERVER_ADDRS 环境变量。
; 仅在使用 TCP 监听套接字时有意义。每个地址必须用逗号分隔。
; 如果此值留空，将接受来自任何 IP 地址的连接。
; 默认值：any
;listen.allowed_clients = 127.0.0.1
listen.allowed_clients =

; 设置关联的路由表 (FIB)。仅限 FreeBSD
; 默认值：-1
;listen.setfib = 1

; 指定应用于进程池进程的 nice(2) 优先级（仅在设置时生效）
; 值的范围从 -19（最高优先级）到 20（最低优先级）
; 注意：- 仅当 FPM 主进程以 root 启动时才有效
;       - 进程池进程将继承主进程的优先级，除非另行指定
; 默认值：未设置
; process.priority = -19

; 设置进程可转储标志（Linux 的 PR_SET_DUMPABLE prctl 或
; FreeBSD 的 PROC_TRACE_CTL procctl），即使进程用户或用户组
; 与主进程用户不同。它允许为进程池用户创建进程核心转储和 ptrace 进程。
; 默认值：no
; process.dumpable = yes

; 选择进程管理器控制子进程数量的方式。
; 可选值：
;   static  - 固定数量（pm.max_children）的子进程；
;   dynamic - 子进程数量根据以下指令动态设置。使用此进程管理方式，
;             始终至少有 1 个子进程。
;             pm.max_children      - 同时可存活的最大子进程数。
;             pm.start_servers     - 启动时创建的子进程数。
;             pm.min_spare_servers - 处于"空闲"状态（等待处理）的最小子进程数。
;                                    如果"空闲"进程数少于此值，
;                                    则会创建一些子进程。
;             pm.max_spare_servers - 处于"空闲"状态（等待处理）的最大子进程数。
;                                    如果"空闲"进程数大于此值，
;                                    则会终止一些子进程。
;             pm.max_spawn_rate    - 一次生成子进程的最大速率。
;  ondemand - 启动时不创建子进程。当有新请求连接时才会 fork 子进程。
;             使用以下参数：
;             pm.max_children           - 同时可存活的最大子进程数。
;             pm.process_idle_timeout   - 空闲进程被终止前的秒数。
; 注意：此值为必填项。
pm = dynamic

; 当 pm 设置为 'static' 时创建的子进程数，以及当 pm 设置为 'dynamic' 或
; 'ondemand' 时的最大子进程数。
; 此值设置了同时处理请求的上限。等同于 mpm_prefork 的 ApacheMaxClients 指令。
; 等同于原始 PHP CGI 中的 PHP_FCGI_CHILDREN 环境变量。
; 以下默认值基于资源不多的服务器。别忘了调整 pm.* 以适应您的需求。
; 注意：当 pm 设置为 'static'、'dynamic' 或 'ondemand' 时使用
; 注意：此值为必填项。
;pm.max_children = 5
pm.max_children = 20

; 启动时创建的子进程数。
; 注意：仅当 pm 设置为 'dynamic' 时使用
; 默认值：(min_spare_servers + max_spare_servers) / 2
;pm.start_servers = 2
pm.start_servers = 5

; 期望的最小空闲服务器进程数。
; 注意：仅当 pm 设置为 'dynamic' 时使用
; 注意：当 pm 设置为 'dynamic' 时为必填项
;pm.min_spare_servers = 1
pm.min_spare_servers = 2

; 期望的最大空闲服务器进程数。
; 注意：仅当 pm 设置为 'dynamic' 时使用
; 注意：当 pm 设置为 'dynamic' 时为必填项
;pm.max_spare_servers = 3
pm.max_spare_servers = 10

; 一次生成子进程的速率。
; 注意：仅当 pm 设置为 'dynamic' 时使用
; 注意：当 pm 设置为 'dynamic' 时为必填项
; 默认值：32
;pm.max_spawn_rate = 32

; 空闲进程被终止前的秒数。
; 注意：仅当 pm 设置为 'ondemand' 时使用
; 默认值：10s
;pm.process_idle_timeout = 10s;
pm.process_idle_timeout = 10s

; 每个子进程在重新生成之前应执行的请求数。
; 这有助于解决第三方库中的内存泄漏问题。设置为 '0' 表示无限请求处理。
; 等同于 PHP_FCGI_MAX_REQUESTS。
; 默认值：0
;pm.max_requests = 500
pm.max_requests = 500

; 查看 FPM 状态页面的 URI。如果未设置此值，则不会将任何 URI 识别为状态页面。
; 它显示以下信息：
;   pool                 - 进程池名称；
;   process manager      - static、dynamic 或 ondemand；
;   start time           - FPM 启动的日期和时间；
;   start since          - FPM 启动以来的秒数；
;   accepted conn        - 进程池接受的请求数；
;   listen queue         - 待处理连接队列中的请求数（参见 listen(2) 中的 backlog）；
;   max listen queue     - 自 FPM 启动以来待处理连接队列中的最大请求数；
;   listen queue len     - 待处理连接的套接字队列大小；
;   idle processes       - 空闲进程数；
;   active processes     - 活跃进程数；
;   total processes      - 空闲 + 活跃进程总数；
;   max active processes - 自 FPM 启动以来的最大活跃进程数；
;   max children reached - 当 pm 尝试启动更多子进程时达到进程限制的次数
;                          （仅适用于 pm 'dynamic' 和 'ondemand'）；
; 值实时更新。
; 示例输出：
;   pool:                 www
;   process manager:      static
;   start time:           01/Jul/2011:17:53:49 +0200
;   start since:          62636
;   accepted conn:        190460
;   listen queue:         0
;   max listen queue:     1
;   listen queue len:     42
;   idle processes:       4
;   active processes:     11
;   total processes:      15
;   max active processes: 12
;   max children reached: 0
;
; 默认情况下，状态页面输出格式为 text/plain。在查询字符串中传递
; 'html'、'xml' 或 'json' 将返回相应的输出语法。示例：
;   http://www.foo.bar/status
;   http://www.foo.bar/status?json
;   http://www.foo.bar/status?html
;   http://www.foo.bar/status?xml
;
; 默认情况下，状态页面仅输出简短状态。在查询字符串中传递 'full'
; 也将返回每个进程池进程的状态。
; 示例：
;   http://www.foo.bar/status?full
;   http://www.foo.bar/status?json&full
;   http://www.foo.bar/status?html&full
;   http://www.foo.bar/status?xml&full
; 完整状态为每个进程返回：
;   pid                  - 进程的 PID；
;   state                - 进程的状态（Idle、Running 等）；
;   start time           - 进程启动的日期和时间；
;   start since          - 进程启动以来的秒数；
;   requests             - 进程已处理的请求数；
;   request duration     - 请求的持续时间（微秒）；
;   request method       - 请求方法（GET、POST 等）；
;   request URI          - 带查询字符串的请求 URI；
;   content length       - 请求的内容长度（仅 POST）；
;   user                 - 用户（PHP_AUTH_USER）（未设置则为 '-'）；
;   script               - 调用的主脚本（未设置则为 '-'）；
;   last request cpu     - 上次请求消耗的 CPU 百分比
;                          如果进程不在 Idle 状态则始终为 0，
;                          因为 CPU 计算在请求处理终止时完成；
;   last request memory  - 上次请求消耗的最大内存
;                          如果进程不在 Idle 状态则始终为 0，
;                          因为内存计算在请求处理终止时完成；
; 如果进程处于 Idle 状态，则信息与进程最后处理的请求相关。
; 否则信息与当前正在处理的请求相关。
; 示例输出：
;   ************************
;   pid:                  31330
;   state:                Running
;   start time:           01/Jul/2011:17:53:49 +0200
;   start since:          63087
;   requests:             12808
;   request duration:     1250261
;   request method:       GET
;   request URI:          /test_mem.php?N=10000
;   content length:       0
;   user:                 -
;   script:               /home/fat/web/docs/php/test_mem.php
;   last request cpu:     0.00
;   last request memory:  0
;
; 注意：有一个实时 FPM 状态监控示例网页可用
;       它位于：/opt/php/share/fpm/status.html
;
; 注意：值必须以斜杠 (/) 开头。值可以是任何内容，但使用 .php 扩展名
;       可能不是一个好主意，因为它可能与真实的 PHP 文件冲突。
; 默认值：未设置
;pm.status_path = /status
pm.status_path = /php-fpm-status

; 接受 FastCGI 状态请求的地址。这将创建一个新的不可见进程池，
; 可以独立处理请求。当主进程池忙于长时间运行的请求时，这非常有用，
; 因为仍然可以在长时间运行的请求完成之前获取状态。
;
; 有效语法：
;   'ip.add.re.ss:port'    - 在特定 IPv4 地址的特定端口上监听 TCP 套接字；
;   '[ip:6:addr:ess]:port' - 在特定 IPv6 地址的特定端口上监听 TCP 套接字；
;   'port'                 - 在所有地址（IPv6 和 IPv4 映射）的特定端口上监听 TCP 套接字；
;   '/path/to/unix/socket' - 监听 Unix 套接字。
; 默认值：listen 选项的值
;pm.status_listen = 127.0.0.1:9001

; 调用 FPM 监控页面的 ping URI。如果未设置此值，则不会将任何 URI 识别为 ping 页面。
; 这可用于从外部测试 FPM 是否存活并响应，或用于：
; - 创建 FPM 可用性图表（rrd 等）；
; - 如果服务器无响应则将其从组中移除（负载均衡）；
; - 为运维团队触发告警（24/7）。
; 注意：值必须以斜杠 (/) 开头。值可以是任何内容，但使用 .php 扩展名
;       可能不是一个好主意，因为它可能与真实的 PHP 文件冲突。
; 默认值：未设置
;ping.path = /ping
ping.path = /php-fpm-ping

; 此指令可用于自定义 ping 请求的响应。
; 响应格式为 text/plain，响应代码为 200。
; 默认值：pong
;ping.response = pong
ping.response = pong

; 访问日志文件
; 默认值：未设置
;access.log = log/$pool.access.log

; 访问日志格式。
; 允许以下语法
;  %%: '%' 字符
;  %C: 请求使用的 CPU 百分比
;      可以接受以下格式：
;      - %{user}C 仅用户 CPU
;      - %{system}C 仅系统 CPU
;      - %{total}C  用户 + 系统 CPU（默认）
;  %d: 处理请求所用时间
;      可以接受以下格式：
;      - %{seconds}d（默认）
;      - %{milliseconds}d
;      - %{milli}d
;      - %{microseconds}d
;      - %{micro}d
;  %e: 环境变量（与 $_ENV 或 $_SERVER 相同）
;      必须使用花括号指定环境变量名称。一些示例：
;      - 服务器特定变量如：%{REQUEST_METHOD}e 或 %{SERVER_PROTOCOL}e
;      - HTTP 头如：%{HTTP_HOST}e 或 %{HTTP_USER_AGENT}e
;  %f: 脚本文件名
;  %l: 请求的内容长度（仅 POST 请求）
;  %m: 请求方法
;  %M: PHP 分配的内存峰值
;      可以接受以下格式：
;      - %{bytes}M（默认）
;      - %{kilobytes}M
;      - %{kilo}M
;      - %{megabytes}M
;      - %{mega}M
;  %n: 进程池名称
;  %o: 输出头
;      必须使用花括号指定头名称：
;      - %{Content-Type}o
;      - %{X-Powered-By}o
;      - %{Transfert-Encoding}o
;      - ....
;  %p: 处理请求的子进程 PID
;  %P: 处理请求的子进程的父进程 PID
;  %q: 查询字符串
;  %Q: 如果存在查询字符串则为 '?' 字符
;  %r: 请求 URI（不含查询字符串，参见 %q 和 %Q）
;  %R: 远程 IP 地址
;  %s: 状态（响应代码）
;  %t: 收到请求的服务器时间
;      可以接受 strftime(3) 格式：
;      %d/%b/%Y:%H:%M:%S %z（默认）
;      strftime(3) 格式必须封装在 %{<strftime_format>}t 标签中
;      例如，ISO8601 格式的时间字符串，使用：%{%Y-%m-%dT%H:%M:%S%z}t
;  %T: 日志写入的时间（请求已完成）
;      可以接受 strftime(3) 格式：
;      %d/%b/%Y:%H:%M:%S %z（默认）
;      strftime(3) 格式必须封装在 %{<strftime_format>}t 标签中
;      例如，ISO8601 格式的时间字符串，使用：%{%Y-%m-%dT%H:%M:%S%z}t
;  %u: 如果在 Authorization 头中指定了基本认证用户
;
; 默认值："%R - %u %t \"%m %r\" %s"
;access.format = "%R - %u %t \"%m %r%Q%q\" %s %f %{milli}d %{kilo}M %C%%"

; 应从访问日志中过滤的 request_uri 值列表。
;
; 作为安全预防措施，在以下情况下此设置将被忽略：
;     - 请求方法不是 GET 或 HEAD；或
;     - 存在请求体；或
;     - 存在查询参数；或
;     - 响应代码不在 200 到 299 的成功范围内
;
; 注意：路径与访问日志格式标签 "%r" 的输出进行匹配。
;       在常见配置中，这可能更像 SCRIPT_NAME 而不是预期的重写前 URI。
;
; 默认值：未设置
;access.suppress_path[] = /ping
;access.suppress_path[] = /health_check.php

; 慢请求日志文件
; 默认值：未设置
; 注意：如果设置了 request_slowlog_timeout，则 slowlog 为必填项
;slowlog = log/$pool.log.slow
slowlog = /opt/php/var/log/php-fpm-slow.log

; 单个请求的超时时间，超过此时间后将把 PHP 回溯信息转储到 'slowlog' 文件。
; 值为 '0s' 表示"关闭"。
; 可用单位：s(秒)(默认)、m(分钟)、h(小时) 或 d(天)
; 默认值：0
;request_slowlog_timeout = 0
request_slowlog_timeout = 5s

; 慢日志堆栈跟踪深度。
; 默认值：20
;request_slowlog_trace_depth = 20

; 单个请求的超时时间，超过此时间后工作进程将被终止。
; 当 'max_execution_time' ini 选项由于某些原因无法停止脚本执行时，
; 应使用此选项。值为 '0' 表示"关闭"。
; 可用单位：s(秒)(默认)、m(分钟)、h(小时) 或 d(天)
; 默认值：0
;request_terminate_timeout = 0
request_terminate_timeout = 300s

; 由 'request_terminate_timeout' ini 选项设置的超时在应用程序调用
; 'fastcgi_finish_request' 或应用程序已完成并正在调用关闭函数
;（通过 register_shutdown_function 注册）后不会生效。
; 此选项将使超时限制无条件应用，即使在这种情况下也是如此。
; 默认值：no
;request_terminate_timeout_track_finished = no

; 设置打开文件描述符的 rlimit 限制。
; 默认值：系统定义值
;rlimit_files = 1024
rlimit_files = 51200

; 设置最大核心转储大小的 rlimit 限制。
; 可选值：'unlimited' 或大于等于 0 的整数
; 默认值：系统定义值
;rlimit_core = 0

; 启动时 chroot 到此目录。此值必须定义为绝对路径。
; 未设置此值时，不使用 chroot。
; 注意：可以使用 '$prefix' 前缀来 chroot 到进程池前缀或其子目录之一。
; 如果未设置进程池前缀，则使用全局前缀。
; 注意：chroot 是一个很好的安全功能，应尽可能使用。
;       但是，所有 PHP 路径将相对于 chroot
;       （error_log、sessions.save_path 等）。
; 默认值：未设置
;chroot =

; 启动时 chdir 到此目录。
; 注意：可以使用相对路径。
; 默认值：当前目录或 chroot 时为 /
;chdir = /var/www

; 将工作进程的 stdout 和 stderr 重定向到主错误日志。如果未设置，stdout 和
; stderr 将根据 FastCGI 规范重定向到 /dev/null。
; 注意：在高负载环境中，这可能会导致页面处理时间出现一些延迟（几毫秒）。
; 默认值：no
;catch_workers_output = yes
catch_workers_output = yes

; 使用包含写入日志的子进程信息的前缀和后缀装饰工作进程输出，
; 以及是否使用 stdout 或 stderr，还有日志级别和时间。
; 此选项仅在 catch_workers_output 为 yes 时使用。
; 设置为 "no" 将按原样输出写入 stdout 或 stderr 的数据。
; 默认值：yes
;decorate_workers_output = no
decorate_workers_output = no

; 清除 FPM 工作进程中的环境变量
; 通过在添加此进程池配置中指定的环境变量之前清除工作进程中的环境，
; 防止任意环境变量到达 FPM 工作进程。
; 设置为 "no" 将使所有环境变量可通过 getenv()、$_ENV 和 $_SERVER 在 PHP 代码中使用。
; 默认值：yes
;clear_env = no
clear_env = yes

; 限制 FPM 允许解析的主脚本扩展名。这可以防止 Web 服务器端的配置错误。
; 您应该仅将 FPM 限制为 .php 扩展名，以防止恶意用户使用其他扩展名执行 PHP 代码。
; 注意：设置空值以允许所有扩展名。
; 默认值：.php
;security.limit_extensions = .php .php3 .php4 .php5 .php7

; 传递环境变量，如 LD_LIBRARY_PATH。所有 $VARIABLE 取自当前环境。
; 默认值：clean env
;env[HOSTNAME] = $HOSTNAME
;env[PATH] = /usr/local/bin:/usr/bin:/bin
;env[TMP] = /tmp
;env[TMPDIR] = /tmp
;env[TEMP] = /tmp

; 附加的 php.ini 定义，特定于此工作进程池。这些设置会覆盖之前在 php.ini 中
; 定义的值。指令与 PHP SAPI 相同：
;   php_value/php_flag             - 可以设置经典的 ini 定义，
;                                    这些定义可以被 PHP 的 'ini_set' 调用覆盖。
;   php_admin_value/php_admin_flag - 这些指令不会被 PHP 的 'ini_set' 调用覆盖。
; 对于 php_*flag，有效值为 on、off、1、0、true、false、yes 或 no。

; 定义 'extension' 将从 extension_dir 加载相应的共享扩展。
; 定义 'disable_functions' 或 'disable_classes' 不会覆盖之前定义的 php.ini 值，
; 而是将新值追加到其后。

; 注意：路径 INI 选项可以是相对的，将使用前缀（进程池、全局或 /opt/php）展开

; 默认值：除了 php.ini 中的值和启动时使用 -d 参数指定的值外，默认不定义任何内容
;php_admin_value[sendmail_path] = /usr/sbin/sendmail -t -i -f www@my.domain.com
;php_flag[display_errors] = off
;php_admin_value[error_log] = /var/log/fpm-php.www.log
;php_admin_flag[log_errors] = on
;php_admin_value[memory_limit] = 32M
