# =======================================================
# OWASP CRS 主引入配置文件
# 路径占位符 %NGINX_DIR% 在 Docker 构建时会被自动替换
# =======================================================
#
# ModSecurity 引擎编译安装路径：%NGINX_DIR%/src/ModSecurity
# ModSecurity-nginx 连接器：%NGINX_DIR%/src/ModSecurity-nginx
# OWASP CRS 规则：/opt/owasp/owasp-rules
#

# 引入 ModSecurity 主配置文件
Include %NGINX_DIR%/conf/modsecurity/modsecurity.conf

# OWASP CRS 规则主配置文件
Include /opt/owasp/owasp-rules/crs-setup.conf

# 引入自定义黑白名单规则文件
include %NGINX_DIR%/conf/modsecurity/hosts.allow
include %NGINX_DIR%/conf/modsecurity/hosts.deny

# ============================
# OWASP-ModSecurity-CRS 核心规则
# 按需引入以避免不必要的性能损失
# ============================

# 请求阶段例外规则列表（用于自定义请求阶段白名单）
include /opt/owasp/owasp-rules/rules/REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf

# ModSecurity 安全规则引擎核心规则初始化
include /opt/owasp/owasp-rules/rules/REQUEST-901-INITIALIZATION.conf

# 常见命令例外规则
include /opt/owasp/owasp-rules/rules/REQUEST-905-COMMON-EXCEPTIONS.conf

# HTTP 请求方式规范强制遵循规则
include /opt/owasp/owasp-rules/rules/REQUEST-911-METHOD-ENFORCEMENT.conf

# 扫描器/爬虫检测及拦截规则
include /opt/owasp/owasp-rules/rules/REQUEST-913-SCANNER-DETECTION.conf

# HTTP 协议规范强制遵循规则
include /opt/owasp/owasp-rules/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf

# HTTP 协议漏洞攻击防护规则
include /opt/owasp/owasp-rules/rules/REQUEST-921-PROTOCOL-ATTACK.conf

# Multipart 请求攻击防护规则
include /opt/owasp/owasp-rules/rules/REQUEST-922-MULTIPART-ATTACK.conf

# 本地文件包含漏洞防护规则
include /opt/owasp/owasp-rules/rules/REQUEST-930-APPLICATION-ATTACK-LFI.conf

# 远程文件包含漏洞防护规则
include /opt/owasp/owasp-rules/rules/REQUEST-931-APPLICATION-ATTACK-RFI.conf

# 远程命令执行漏洞防护规则
include /opt/owasp/owasp-rules/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf

# PHP 应用程序漏洞攻击防护规则
include /opt/owasp/owasp-rules/rules/REQUEST-933-APPLICATION-ATTACK-PHP.conf

# 通用应用程序攻击防护规则（Node.js、Ruby、Perl）
include /opt/owasp/owasp-rules/rules/REQUEST-934-APPLICATION-ATTACK-GENERIC.conf

# 跨站脚本攻击防护规则
include /opt/owasp/owasp-rules/rules/REQUEST-941-APPLICATION-ATTACK-XSS.conf

# SQL 注入攻击防护规则
include /opt/owasp/owasp-rules/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf

# Session 会话信息漏洞防护规则
include /opt/owasp/owasp-rules/rules/REQUEST-943-APPLICATION-ATTACK-SESSION-FIXATION.conf

# Java 应用程序漏洞防护规则（按需启用）
#include /opt/owasp/owasp-rules/rules/REQUEST-944-APPLICATION-ATTACK-JAVA.conf

# 请求阶段恶意动作检测规则
include /opt/owasp/owasp-rules/rules/REQUEST-949-BLOCKING-EVALUATION.conf

# 通用数据信息泄漏检测规则
include /opt/owasp/owasp-rules/rules/RESPONSE-950-DATA-LEAKAGES.conf

# SQL 数据泄漏检测规则
include /opt/owasp/owasp-rules/rules/RESPONSE-951-DATA-LEAKAGES-SQL.conf

# Java 源码泄漏检测规则（按需启用）
#include /opt/owasp/owasp-rules/rules/RESPONSE-952-DATA-LEAKAGES-JAVA.conf

# PHP 源码泄漏检测规则
include /opt/owasp/owasp-rules/rules/RESPONSE-953-DATA-LEAKAGES-PHP.conf

# IIS 信息泄漏检测规则（按需启用）
#include /opt/owasp/owasp-rules/rules/RESPONSE-954-DATA-LEAKAGES-IIS.conf

# Web Shell 检测规则（按需启用）
#include /opt/owasp/owasp-rules/rules/RESPONSE-955-WEB-SHELLS.conf

# 应答阶段恶意动作检测规则
include /opt/owasp/owasp-rules/rules/RESPONSE-959-BLOCKING-EVALUATION.conf

# 相关性联合检测防护规则
include /opt/owasp/owasp-rules/rules/RESPONSE-980-CORRELATION.conf

# 应答阶段例外规则列表（用于自定义白名单）
include /opt/owasp/owasp-rules/rules/RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf

# WordPress 排除规则插件（按需启用）
#include /opt/owasp/owasp-rules/plugins/wordpress-rule-exclusions-before.conf
#include /opt/owasp/owasp-rules/plugins/wordpress-rule-exclusions-config.conf
