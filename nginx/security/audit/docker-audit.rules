# Docker 和 Nginx 安全审计规则
# 适用于 Linux auditd 审计框架
# 用途：监控 Docker 容器环境和 Nginx 服务的关键操作

# ============================================
# Docker 守护进程监控
# 监控 Docker 守护进程二进制文件的执行和修改
# ============================================
-w /usr/bin/dockerd -k docker-daemon
-w /usr/bin/docker -k docker-binary

# ============================================
# Docker 配置文件监控
# 监控 Docker 配置目录和守护进程配置文件的变更
# ============================================
-w /etc/docker/ -k docker-config
-w /etc/docker/daemon.json -p wa -k docker-daemon-config

# ============================================
# Docker 套接字监控
# 监控 Docker Unix 套接字的访问，防止未授权操作
# ============================================
-w /var/run/docker.sock -p rwxa -k docker-socket

# ============================================
# Docker 数据目录监控
# 监控 Docker 数据存储目录，包括镜像和容器数据
# ============================================
-w /var/lib/docker/ -p wa -k docker-data

# ============================================
# Nginx 二进制文件监控
# 监控 Nginx 主程序文件的修改和执行
# ============================================
-w /opt/nginx/sbin/nginx -p wa -k nginx-binary

# ============================================
# Nginx 配置文件监控
# 监控 Nginx 配置目录的所有变更操作
# ============================================
-w /opt/nginx/conf/ -p wa -k nginx-config

# ============================================
# Nginx 日志目录监控
# 监控 Nginx 日志文件，防止日志被篡改或删除
# ============================================
-w /opt/nginx/logs/ -p wa -k nginx-logs

# ============================================
# SSL 证书监控
# 监控 SSL/TLS 证书文件的访问和修改
# ============================================
-w /opt/nginx/ssl/ -p wa -k nginx-ssl

# ============================================
# 系统认证文件监控
# 监控关键系统用户和权限文件的变更
# ============================================
-w /etc/passwd -p wa -k system-auth
-w /etc/shadow -p wa -k system-auth
-w /etc/group -p wa -k system-auth
